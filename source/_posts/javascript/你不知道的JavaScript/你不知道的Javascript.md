---
title: 如何理解Javascript中的作用域
date: 2024-04-27 10:49:10
tags: [Javascript]
---

## 什么是作用域
在所有编程语言中，都支持存储变量，可以对其修改赋值，也可以在日后某个时刻使用这个变量。
而这些变量存储在哪里？在需要使用时如何找到他们？能够使用哪些变量？
这就需要一套规则，这套规则就是作用域。**规定了如何存储找到可使用的变量**。

### JavaScript中的作用域
在使用变量之前，我们一般都会先给变量定义赋值。

#### 赋值语句
下面看下一句简单的赋值语句`var a = 2;`做了些什么。

1.看到`var a`，编译器首先会询问作用域是否有名为`a`的变量存在同一个作用域集合中。
2.如果存在，则忽略声明，继续编译。反之，则要求作用域在当前作用域的集合中声明一个新的变量名为`a`。
3.引擎运行代码，遇到`a = 2`，首先询问作用域，是否存在叫做`a`的变量，如果是则使用这个变量，否则继续查找。
4.最终引擎将找到了变量`a`，并将2赋值给它。否则引擎会抛出一个异常。

#### 赋值语句总结
**总结**：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。


#### LHS与RHS
在查找变量的过程中分为两种类型LHS和RHS。
简单地理解为赋值语句的左侧为LHS查询，右侧为RHS查询。

LHS查询试图找到变量的容器本身，从而可以对其赋值。
RHS查询则是找到源值（retrieve his source value）。

### 作用域嵌套
当一个块或者函数嵌套在另一个块或者函数中，就发生了作用域的嵌套。

具体表现在：如果在当前作用域中无法找到某个变量，引擎则会去外层作用域中继续查找，直到找到该变量或者抵达最外层作用域（也就是全局作用域）停止。

这样的查找形成了一条链，于是叫他作用域链。

### 异常
在变量的查找当中，会出现一些查找不到的情况，这样会出现异常。

但是异常的发生与具体的查询类型有关系。

如果RHS查询在所有作用域中都找不到变量，则会抛出`ReferenceError`。
而LHS查询，如果在全局作用域中都无法找到并且处于非严格模式，则会创建该名称变量，并返回给引擎。如果是严格模式，同样抛出`ReferenceError`。

还有一种`TypeError`，常常发生在给引用`null`或者`undefined`值。
这两个异常的区别在于：
`ReferenceError`作用域中查找失败。
`TypeError`作用域中查找成功，但是操作不合理。
